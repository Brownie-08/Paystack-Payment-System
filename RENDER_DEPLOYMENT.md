# Render Deployment Guide

This guide will help you deploy your Django Paystack Payment App to Render.

## Prerequisites

1. GitHub repository with your code
2. Render account (sign up at https://render.com)
3. Paystack account with API keys

## Step 1: Prepare Your Repository

Make sure your repository has:
- ✅ `render.yaml` (deployment configuration)
- ✅ `build.sh` (build script)
- ✅ `requirements.txt` (Python dependencies)
- ✅ `runtime.txt` (Python version specification)

## Step 2: Deploy to Render

### Option A: Using render.yaml (Recommended)

1. **Connect Repository**:
   - Go to https://render.com/dashboard
   - Click "New +" → "Blueprint"
   - Connect your GitHub repository
   - Select the repository containing your Django app

2. **Render will automatically**:
   - Create a PostgreSQL database
   - Create a web service
   - Set up basic environment variables
   - Deploy your application

### Option B: Manual Setup

1. **Create Database First**:
   - Go to Render Dashboard
   - Click "New +" → "PostgreSQL"
   - Name: `paystack-payment-db`
   - Plan: Free
   - Note down the database connection details

2. **Create Web Service**:
   - Click "New +" → "Web Service"
   - Connect your GitHub repository
   - Configure:
     - Name: `paystack-payment-app`
     - Environment: `Python 3`
     - Build Command: `./build.sh`
     - Start Command: `gunicorn payment_project.wsgi:application --bind 0.0.0.0:$PORT --workers 3 --timeout 120`

## Step 3: Configure Environment Variables

In your Render web service dashboard, add these environment variables:

### Required Variables:
```
DEBUG=false
SECRET_KEY=[Generated by Render]
DATABASE_URL=[Automatically set by Render]
```

### Paystack Configuration:
```
PAYSTACK_SECRET_KEY=sk_test_your_secret_key
PAYSTACK_PUBLIC_KEY=pk_test_your_public_key
PAYSTACK_BASE_URL=https://api.paystack.co
```

### URL Configuration:
```
FRONTEND_CALLBACK_URL=https://yourfrontend.com/payment/callback
BACKEND_WEBHOOK_URL=https://your-app-name.onrender.com/api/payments/webhook/
RENDER_EXTERNAL_URL=https://your-app-name.onrender.com
```

### CORS Configuration (Optional):
```
CORS_ALLOW_ALL_ORIGINS=false
ALLOWED_HOSTS=your-app-name.onrender.com
```

## Step 4: Update URLs

After deployment, update these URLs with your actual Render URLs:

1. **In render.yaml**: Update `BACKEND_WEBHOOK_URL` and `RENDER_EXTERNAL_URL`
2. **In Paystack Dashboard**: Update webhook URL to `https://your-app-name.onrender.com/api/payments/webhook/`
3. **Frontend Application**: Update API base URL to point to your Render app

## Step 5: Test Your Deployment

1. **Check Health**:
   ```
   curl https://your-app-name.onrender.com/api/payments/health/
   ```

2. **Test API Documentation**:
   ```
   https://your-app-name.onrender.com/api/schema/swagger-ui/
   ```

3. **Test Payment Flow**:
   - Initialize payment
   - Complete payment with test card
   - Verify webhook receives events

## Common Issues and Solutions

### Build Failures

**Issue**: Build fails during `pip install`
**Solution**: Check your `requirements.txt` for any invalid dependencies

**Issue**: `./build.sh` permission denied
**Solution**: Make sure build.sh has executable permissions:
```bash
git update-index --chmod=+x build.sh
```

### Database Issues

**Issue**: Database connection fails
**Solution**: 
- Verify `DATABASE_URL` is set correctly
- Check if database is in the same region as web service

### Static Files Issues

**Issue**: Static files not loading
**Solution**:
- Ensure `whitenoise` is in requirements.txt
- Verify `STATIC_ROOT` is set correctly in settings.py

### Environment Variables

**Issue**: Environment variables not loading
**Solution**:
- Check variable names match exactly
- Ensure no trailing spaces in values
- Restart service after adding variables

## Production Checklist

- [ ] All Railway references removed
- [ ] `render.yaml` configured correctly
- [ ] `build.sh` is executable
- [ ] Environment variables set in Render dashboard
- [ ] Database connected and migrated
- [ ] Static files configured
- [ ] CORS settings updated
- [ ] Paystack webhook URL updated
- [ ] SSL/HTTPS working
- [ ] API endpoints accessible
- [ ] Payment flow tested

## Monitoring and Logs

1. **View Logs**:
   - Go to your service in Render dashboard
   - Click on "Logs" tab
   - Monitor for any errors

2. **Health Checks**:
   - Render automatically health checks your app
   - Endpoint: `https://your-app-name.onrender.com/`

## Scaling (Paid Plans)

For production use, consider upgrading to paid plans:
- **Starter Plan ($7/month)**: No sleep, better performance
- **Standard Plan ($25/month)**: More resources, advanced features

## Support

- **Render Docs**: https://render.com/docs
- **Django on Render**: https://render.com/docs/deploy-django
- **Community Forum**: https://community.render.com

## Next Steps

1. Set up monitoring and alerts
2. Configure custom domain (paid feature)
3. Set up automated backups for database
4. Implement CI/CD pipeline for automatic deployments

---

**Note**: Free tier services on Render may sleep after 15 minutes of inactivity. Consider upgrading to paid plans for production use.
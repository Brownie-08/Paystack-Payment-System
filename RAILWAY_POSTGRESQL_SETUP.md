# 🗄️ Railway PostgreSQL Setup Guide

## 🚨 **Current Issue:**
Your app is using SQLite instead of PostgreSQL in production, and database migrations haven't been applied.

## 🔧 **Step 1: Add PostgreSQL Service to Railway**

1. **Go to Railway Dashboard** → Your Project
2. **Click "New"** → **"Database"** → **"PostgreSQL"**
3. **Railway automatically creates** a PostgreSQL database and sets `DATABASE_URL` environment variable

## ✅ **Step 2: Verify Environment Variables**

After adding PostgreSQL, your Railway variables should include:
```bash
# Auto-generated by Railway when you add PostgreSQL
DATABASE_URL=postgresql://user:pass@host:port/dbname

# Your existing variables
SECRET_KEY=^f+t(2fic6j412bzl0e*fjj%vla8v!koevj-b!oo&1imk1xh1c
DEBUG=False
RAILWAY_ENVIRONMENT=production
ALLOWED_HOSTS=*
ADMIN_USERNAME=admin
ADMIN_EMAIL=admin@gmail.com
ADMIN_PASSWORD=Paystack123
PAYSTACK_SECRET_KEY=sk_test_af714b2b039b47efe9787f2414909877add26bda
PAYSTACK_PUBLIC_KEY=pk_test_164c1d3129e0c18d98cfe53dcc19a8b9973a90dd
PAYSTACK_BASE_URL=https://api.paystack.co
CORS_ALLOW_ALL_ORIGINS=True
```

## 🚀 **Step 3: Deploy and Check Logs**

After adding PostgreSQL, Railway will auto-redeploy. Look for these logs:

### ✅ **Success Logs:**
```bash
📊 Database info:
Engine: django.db.backends.postgresql
Name: railway

🔗 Testing database connection...
Database connection successful

🗺 Checking existing migrations...
payments [ ] 0001_initial

🔄 Making new migrations...
No changes detected

🗄️ Running database migrations...
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, payments, sessions
Running migrations:
  Applying contenttypes.0001_initial... OK
  Applying auth.0001_initial... OK
  Applying admin.0001_initial... OK
  Applying payments.0001_initial... OK
  [... more migrations ...]

👤 Creating superuser...
✅ Superuser created successfully!
   Username: admin
   Email: admin@gmail.com

✅ Deployment completed successfully!
```

### ❌ **Error Logs (if still using SQLite):**
```bash
📊 Database info:
Engine: django.db.backends.sqlite3
Name: /app/db.sqlite3
```

## 🎯 **Step 4: Test Your App**

After successful deployment:

1. **✅ Health Check**: `https://your-app.railway.app/health/`
2. **✅ Homepage**: `https://your-app.railway.app/` (should show stats)
3. **✅ Admin Login**: `https://your-app.railway.app/admin/`
4. **✅ API Stats**: `https://your-app.railway.app/api/stats/` (should show counts, not errors)

## 🔧 **Step 5: Configure Paystack Webhook**

Once your app is working:

1. **Paystack Dashboard**: https://dashboard.paystack.com/settings/developer
2. **Webhook URL**: `https://your-app.railway.app/api/payments/webhook/`
3. **Events**: ✅ `charge.success`, ✅ `charge.failed`

## 🛠️ **Troubleshooting**

### **If still getting SQLite:**
- Check that PostgreSQL service was added to Railway project
- Verify `DATABASE_URL` environment variable exists
- Check deployment logs for database configuration

### **If migrations fail:**
- Check PostgreSQL service is running in Railway
- Verify database connection with health check: `/health/`

### **If superuser creation fails:**
- Login to Railway console: `railway shell`
- Run manually: `python manage.py create_superuser_if_none_exists --force`

## 🎉 **Expected Final Result:**

- ✅ PostgreSQL database with all tables created
- ✅ Superuser account ready (admin/Paystack123)
- ✅ Payment system fully functional
- ✅ Webhook endpoint ready for Paystack
- ✅ No more "no such table" errors

Your Django Paystack app will be production-ready! 🚀